import{_ as e}from"./supabase-b757118e.js";import{j as s}from"./index-d7476741.js";import{d as a,r as t}from"./vendor-d250a0bb.js";import{g as i}from"./fileUpload-ba105336.js";import{l as r}from"./logger-69539a39.js";import{R as l,w as n,U as c,f as d,P as m,g as o,a as x,x as h,n as p,y as u,z as j,u as g,v as N}from"./ui-edd6d7af.js";const y=()=>{const y=a(),[b,f]=t.useState([]),[v,w]=t.useState(!0),[z,_]=t.useState(""),[C,S]=t.useState(""),[L,k]=t.useState(null),[A,E]=t.useState(""),D=t.useCallback(()=>{localStorage.getItem("isAuthenticated")||y("/admin-login")},[y]);t.useEffect(()=>{D(),M().catch(e=>{r.error("Failed to fetch submissions:",e),_("Failed to load submissions"),w(!1)})},[D]);const M=async()=>{w(!0);try{const{getSupabase:s}=await e(()=>import("./supabase-9caa56d7.js"),["./supabase-9caa56d7.js","./supabase-b757118e.js","./vendor-d250a0bb.js","./logger-69539a39.js"],import.meta.url),a=s();if(!a)throw new Error("Supabase not configured");const{data:t,error:i}=await a.from("contact_submissions").select("*").order("created_at",{ascending:!1});if(i)throw new Error(i.message);f(t||[])}catch(s){r.error("Error fetching submissions:",s),_("Failed to load submissions")}finally{w(!1)}},F=e=>{if(!e)return[];try{return JSON.parse(e)}catch{return[]}},R=b.filter(e=>{var s,a,t,i;const r=!C||(null==(s=e.name)?void 0:s.toLowerCase().includes(C.toLowerCase()))||(null==(a=e.email)?void 0:a.toLowerCase().includes(C.toLowerCase()))||(null==(t=e.company)?void 0:t.toLowerCase().includes(C.toLowerCase()))||(null==(i=e.message)?void 0:i.toLowerCase().includes(C.toLowerCase())),l=!A||e.service===A;return r&&l}),T=[...new Set(b.map(e=>e.service).filter(Boolean))].sort();return v?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(l,{className:"animate-spin",size:24}),s.jsx("span",{children:"Loading submissions..."})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-secondary-900",children:"Admin Dashboard"}),s.jsx("p",{className:"text-sm sm:text-base text-secondary-600 hidden sm:block",children:"Manage contact form submissions"})]}),s.jsxs("button",{onClick:async()=>{try{const{supabase:s}=await e(()=>import("./supabase-9caa56d7.js"),["./supabase-9caa56d7.js","./supabase-b757118e.js","./vendor-d250a0bb.js","./logger-69539a39.js"],import.meta.url);await s.auth.signOut()}catch(s){r.error("Logout error:",s)}localStorage.removeItem("isAuthenticated"),y("/admin-login")},className:"flex items-center space-x-1 sm:space-x-2 px-3 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 text-sm sm:text-base",children:[s.jsx(n,{size:16,className:"sm:hidden"}),s.jsx(n,{size:18,className:"hidden sm:block"}),s.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})]})})}),s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(c,{className:"text-primary-600",size:20}),s.jsxs("div",{className:"ml-3 sm:ml-4",children:[s.jsx("p",{className:"text-xs sm:text-sm font-medium text-secondary-600",children:"Total Submissions"}),s.jsx("p",{className:"text-xl sm:text-2xl font-bold text-secondary-900",children:b.length})]})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(d,{className:"text-green-600",size:20}),s.jsxs("div",{className:"ml-3 sm:ml-4",children:[s.jsx("p",{className:"text-xs sm:text-sm font-medium text-secondary-600",children:"This Month"}),s.jsx("p",{className:"text-xl sm:text-2xl font-bold text-secondary-900",children:b.filter(e=>new Date(e.created_at).getMonth()===(new Date).getMonth()).length})]})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(m,{className:"text-blue-600",size:20}),s.jsxs("div",{className:"ml-3 sm:ml-4",children:[s.jsx("p",{className:"text-xs sm:text-sm font-medium text-secondary-600",children:"With Attachments"}),s.jsx("p",{className:"text-xl sm:text-2xl font-bold text-secondary-900",children:b.filter(e=>e.files_count>0).length})]})]})})]}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6 mb-4 sm:mb-6",children:s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(o,{className:"absolute left-3 top-2.5 text-gray-400 pointer-events-none z-10",size:18}),s.jsx("input",{type:"text",placeholder:"Search submissions...",value:C,onChange:e=>S(e.target.value),className:"w-full pl-10 pr-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 relative z-0"})]})}),s.jsx("div",{className:"w-full sm:w-64",children:s.jsxs("select",{value:A,onChange:e=>E(e.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white appearance-none cursor-pointer",children:[s.jsxs("option",{value:"",children:["All Services (",b.length,")"]}),T.length>0?T.map(e=>s.jsxs("option",{value:e,children:[e," (",b.filter(s=>s.service===e).length,")"]},e)):s.jsx("option",{disabled:!0,children:"No services available"})]})}),s.jsxs("button",{onClick:M,className:"flex items-center justify-center space-x-1 sm:space-x-2 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-200",children:[s.jsx(l,{size:16}),s.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})}),z&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:s.jsx("p",{className:"text-red-800",children:z})}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[s.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b bg-gray-50",children:s.jsxs("h2",{className:"text-base sm:text-lg font-semibold text-secondary-900",children:["Contact Submissions (",R.length,")"]})}),0===R.length?s.jsxs("div",{className:"p-8 sm:p-12 text-center",children:[s.jsx(c,{className:"mx-auto text-gray-400 mb-4",size:36}),s.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"No submissions found"})]}):s.jsx("div",{className:"divide-y divide-gray-200",children:R.map(e=>{return s.jsxs("div",{className:"p-4 sm:p-6 hover:bg-gray-50 transition-colors duration-200",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[s.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[s.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[s.jsx(x,{className:"text-primary-600 flex-shrink-0",size:16}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:"font-semibold text-sm sm:text-base text-secondary-900 truncate",children:e.name}),s.jsx("p",{className:"text-xs sm:text-sm text-secondary-600 truncate",children:e.email})]})]}),s.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[s.jsx(h,{className:"text-secondary-500 flex-shrink-0",size:16}),s.jsx("span",{className:"text-xs sm:text-sm text-secondary-700 truncate",children:e.company||"No company"})]}),s.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[s.jsx(p,{className:"text-secondary-500 flex-shrink-0",size:16}),s.jsx("span",{className:"text-xs sm:text-sm text-secondary-700",children:(a=e.created_at,new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]}),e.service&&s.jsx("div",{className:"inline-block",children:s.jsx("span",{className:"px-2 sm:px-3 py-1 bg-primary-100 text-primary-800 rounded-full text-xs sm:text-sm font-medium",children:e.service})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(u,{className:"text-secondary-500",size:18}),s.jsx("span",{className:"font-medium text-secondary-700",children:"Message"})]}),s.jsx("p",{className:"text-secondary-700 text-sm leading-relaxed",children:e.message.length>150?`${e.message.substring(0,150)}...`:e.message})]}),e.files_count>0&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(m,{className:"text-secondary-500",size:18}),s.jsxs("span",{className:"font-medium text-secondary-700",children:[e.files_count," Attachment(s)"]})]}),e.files_data&&s.jsx("div",{className:"space-y-2",children:F(e.files_data).map((e,a)=>s.jsxs("button",{onClick:()=>(async(e,s)=>{try{const a=await i(e),t=document.createElement("a");t.href=a,t.download=s,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(a){r.error("Failed to download file:",a)}})(e.storagePath,e.originalName),className:"flex items-center space-x-2 text-sm text-primary-600 hover:text-primary-700 transition-colors duration-200",children:[s.jsx(j,{size:14}),s.jsx("span",{children:e.originalName}),s.jsxs("span",{className:"text-xs text-gray-500",children:["(",(e.size/1024/1024).toFixed(2)," MB)"]})]},a))})]})]})]}),s.jsx("button",{onClick:()=>k((null==L?void 0:L.id)===e.id?null:e),className:"ml-4 p-2 text-gray-400 hover:text-gray-600 transition-colors duration-200",children:(null==L?void 0:L.id)===e.id?s.jsx(g,{size:20}):s.jsx(N,{size:20})})]}),(null==L?void 0:L.id)===e.id&&s.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-secondary-900 mb-3",children:"Additional Details"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-secondary-600",children:"Budget:"}),s.jsx("span",{className:"text-secondary-900",children:e.budget||"Not specified"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-secondary-600",children:"Timeline:"}),s.jsx("span",{className:"text-secondary-900",children:e.timeline||"Not specified"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-secondary-600",children:"Revenue:"}),s.jsx("span",{className:"text-secondary-900",children:e.revenue||"Not specified"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-secondary-900 mb-3",children:"Full Message"}),s.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:s.jsx("p",{className:"text-sm text-secondary-700 leading-relaxed whitespace-pre-wrap",children:e.message})})]})]})})]},e.id);var a})})]})]})]})};export{y as default};
